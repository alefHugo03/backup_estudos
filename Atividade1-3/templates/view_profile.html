{% extends "base.html" %}
{% block title %}
    Perfil de {{ profile.get('nome_negocio') or profile.get('nome_sponsor') or profile.get('contato_email', 'Usuário') }} - Conecta Investe
{% endblock %}
{% block content %}
{# Adicionada a classe customizada 'profile-main-card' #}
<div class="card shadow-sm profile-main-card">
    <div class="card-body p-4">
        <div class="row">
            <div class="col-md-3 text-center mb-3 mb-md-0">
                <img src="{{ profile.display_image_url or url_for('static', filename='profile_pics/default_avatar.png') }}" alt="Foto de {{ profile.get('nome_negocio') or profile.get('nome_sponsor') }}" class="img-fluid rounded-circle border" style="width: 180px; height: 180px; object-fit: cover;">
            </div>
            <div class="col-md-9">
                <div class="d-flex justify-content-between align-items-start">
                    <h2 class="mb-0">
                        {% if profile.profile_type == 'empreendedor' %}
                            {{ profile.get('nome_negocio', 'Empreendedor sem nome') }}
                        {% elif profile.profile_type == 'sponsor' %}
                            {{ profile.get('nome_sponsor', 'Sponsor sem nome') }}
                        {% else %}
                            Perfil de Usuário
                        {% endif %}
                    </h2>
                    {% if is_own_profile %}
                        <a href="{{ url_for('create_edit_profile') }}" class="btn btn-outline-primary btn-sm">Editar Perfil</a>
                    {% endif %}
                </div>
                <p class="text-muted">Tipo de Perfil: {{ profile.profile_type | capitalize }}</p>
                <hr>
                <p><strong>Email de Contato:</strong> {{ profile.get('contato_email', 'Não informado') }}</p>
                {% if profile.get('contato_telefone') %}
                    <p><strong>Telefone de Contato:</strong> {{ profile.get('contato_telefone') }}</p>
                {% endif %}
            </div>
        </div>
        <hr class="my-4">
        <div class="profile-details">
            <h3 class="mb-3">Detalhes Específicos do Perfil</h3>
            {% if profile.profile_type == 'empreendedor' %}
                <p><strong>Descrição da Atuação:</strong> {{ profile.get('descricao_negocio', 'Não informado') }}</p>
                <p><strong>Nicho de Mercado:</strong> {{ profile.get('nicho_mercado', 'Não informado') }}</p>
                <p><strong>Tempo de Operação:</strong> {{ profile.get('tempo_operacao', 'Não informado') }}</p>
                <p><strong>Valor de Patrocínio Buscado:</strong> R$ {{ profile.get('patrocinio_buscado_valor', 'Não informado') }}</p>
                <p><strong>Tipo de Apoio Buscado:</strong> {{ profile.get('patrocinio_buscado_tipo', 'Não informado') }}</p>
                <p><strong>O que Oferecem em Troca:</strong> {{ profile.get('contrapartida', 'Não informado') }}</p>
            {% elif profile.profile_type == 'sponsor' %}
                <p><strong>Valor de Investimento Disponível:</strong> R$ {{ profile.get('valor_disponivel_investimento', 'Não informado') }}</p>
                <p><strong>Nichos de Interesse:</strong> {{ profile.get('nichos_interesse', []) | join(', ') if profile.get('nichos_interesse') else 'Não informado' }}</p>
                <p><strong>Expectativa de Retorno:</strong> {{ profile.get('expectativa_retorno', 'Não informado') }}</p>
                <p><strong>Expertises Adicionais:</strong> {{ profile.get('expertise_adicional', 'Não informado') }}</p>
            {% endif %}
            {% if not is_own_profile and session.get('user_id') and session.get('user_type') == 'sponsor' and profile.profile_type == 'empreendedor' %}
                <form action="{{ url_for('express_interest', empreendedor_profile_id=profile['_id']) }}" method="POST" class="mt-3">
                    <button type="submit" class="btn btn-success">Expressar Interesse neste Negócio</button>
                </form>
            {% endif %}
        </div>
    </div>
</div>
<hr class="my-4">
<h3 class="mb-3">Posts de {{ profile.get('nome_negocio') or profile.get('nome_sponsor') or 'Este Usuário' }}</h3>
{% if user_posts %}
    {% for post in user_posts %}
    <div class="card mb-3 shadow-sm">
        {# Removida a classe 'bg-light' para que o tema CSS controle o fundo do card-header #}
        <div class="card-header d-flex justify-content-between align-items-center p-2">
            <small class="text-muted">{{ post.created_at.strftime('%d/%m/%Y às %H:%M') }}</small>
            {% if is_own_profile %}
                <form action="{{ url_for('delete_post', post_id_str=post['_id']) }}" method="POST" onsubmit="return confirm('Tem certeza que deseja deletar este post? Esta ação não pode ser desfeita.');">
                    <button type="submit" class="btn btn-sm btn-outline-danger">Deletar Post</button>
                </form>
            {% endif %}
        </div>
        <div class="card-body">
            {% if post.text_content %}
                <p class="card-text" style="white-space: pre-wrap;">{{ post.text_content }}</p>
            {% endif %}
            {% if post.image_filename %}
                <div class="text-center mt-2">
                    <img src="{{ post.display_image_url }}" class="img-fluid rounded border" alt="Imagem do Post" style="max-height: 400px;">
                </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
{% else %}
    {# Alterado de alert-secondary para alert-info para melhor adaptação ao tema #}
    <div class="alert alert-info">
        <p class="mb-0">{{ profile.get('nome_negocio') or profile.get('nome_sponsor') or 'Este usuário' }} ainda não fez nenhum post.</p>
    </div>
{% endif %}
{% endblock %}